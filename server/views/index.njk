<!DOCTYPE html>
<html lang="en">
  {% include "partials/head.njk" %}
  <body class="index-page {% if userSettings.darkModeTheme %}dark-theme{% endif %}">
    <!-- prettier-ignore -->
    {% set userSettings = userSettings %}
    {% set basePath = basePath %}
    {% set isSubPage = isSubPage %}
    {% set currentSubredditBrowsing = currentSubredditBrowsing %}
    {% include 'partials/page-header.njk' %}
    <main>
      {% if userSettings.subreddits.length < 1 %}
      <div class="welcome">
        <div class="roffline-logotitle">{% include 'partials/roffline-logo.njk' %}</div>
        <h1>Welcome To Roffline (Reddit, Offline)</h1>
        <p>To get started, add a subreddit on the <a href="/sub-management">sub-management</a> page.</p>
        <p>Alternatively, you can bulk import subreddits from the <a href="/settings">settings</a> page.</p>
      </div>
      {% else %} {% if isSubPage %}
      <h4 class="filter-header text-grey">Sub: <# currentSubredditBrowsing | capitalize #></h4>
      {% endif %} {% if topFilter %}
      <h4 class="filter-header text-grey">Top: <# topFilter | capitalize #></h4>
      {% endif %}
      <div id="posts">
        {% if posts.length > 1 %}
        <template v-for="(post, index) in posts" :key="post.id">
          <div class="post-container">
            <article>
              <h2>
                <a href="`/post/${ post.id }`">{{ post.title }}</a>
              </h2>
              <post-content-item v-if="!userSettings.onlyShowTitlesInFeed"></post-content-item>
              <post-content-item-meta-container
                v-bind:subreddit="post.subreddit"
                v-bind:author="post.author"
                v-bind:permalink="post.permalink"
                v-bind:score="post.score"
                v-bind:pretty-date-created="post.prettyDateCreated"
                v-bind:pretty-date-created-ago="post.prettyDateCreatedAgo"
              ></post-content-item-meta-container>
            </article>
            <div class="page-seperator" v-if="shouldShowPageSeperator(index)">
              <hr />
              <h4 class="page-seperator">{{ `Page ${((index + 1) / 30) + 1}` }}</h4>
              <hr />
            </div>
          </div>
        </template>
        {% else %}
        <p class="no-posts-found-message">This subreddit either has no posts, or is in the download queue.</p>
        {% endif %}
      </div>
      {% include 'partials/pagination.njk' %} {% endif %}
    </main>

    <!-- prettier-ignore -->
    {# Doing it this way so the editor doesnt complain about the nunjucks tags in the script element not being valid JS #}
    <# unescapeHTML('%3Cscript%3E') | safe #> 
      window.userSettings = <# userSettings | dump | safe #>
      window.posts = <# posts | dump | safe #> 
    <# unescapeHTML('%3C/script%3E') | safe #>
    <script src="/js/index-page.js<# cacheBustString #>" type="module"></script>
  </body>
</html>
